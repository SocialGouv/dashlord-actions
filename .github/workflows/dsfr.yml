on:
  push:
    branches: ["*"]
    paths:
      - dsfr/**
      - .github/workflows/dsfr.yml
  pull_request:
    branches: ["*"]
    paths:
      - dsfr/**
      - .github/workflows/dsfr.yml

name: Tests dsfr action
jobs:
  tests-dsfr-valid:
    runs-on: ubuntu-latest
    name: dsfr action
    continue-on-error: true
    strategy:
      matrix:
        url:
          [
            "https://talents.ssi.gouv.fr",
            "https://histologe.beta.gouv.fr/",
            "https://beta.gouv.fr",
          ]
    steps:
      - uses: actions/checkout@v3
      - name: Test DSFR detection on ${{ matrix.url }}
        uses: ./dsfr
        with:
          url: ${{ matrix.url }}
          output: ${{ matrix.url | base64 }}.json
      - shell: bash
        run: |
          cat ${{ matrix.url | base64 }}.json
          grep "\"detected\": true" < ${{ matrix.url | base64 }}.json
  tests-dsfr-invalid:
    runs-on: ubuntu-latest
    name: dsfr action
    continue-on-error: true
    strategy:
      matrix:
        url:
          [
            "https://dashlord.incubateur.net/",
            "https://anais.beta.gouv.fr/",
            "https://mesevenementsemploi.pole-emploi.fr/",
          ]
    steps:
      - uses: actions/checkout@v3
      - name: Test DSFR detection on ${{ matrix.url }}
        uses: ./dsfr
        with:
          url: ${{ matrix.url }}
          output: ${{ matrix.url | base64 }}.json
      - shell: bash
        run: |
          cat ${{ matrix.url | base64 }}.json
          grep "\"detected\": false" < ${{ matrix.url | base64 }}.json
